{% load humanize %}
{% load static %}
{% load persian_filters %}
{% load star_rating %}

<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بیشتر</title>

    <link rel="stylesheet" href="{% static 'mainpage/style.css' %}?v=9">
    <link rel="stylesheet" href="{% static 'more_products/style.css' %}?v=9">
    <link rel="stylesheet" href="{% static 'fontawesome/css/all.min.css' %}">
</head>
<body>
    <div class="container" style="margin: 0 auto;">
        <section class="products-box">
            <aside id="aside">
                <h3 class="filter-title" id="filter-toggle">
                    فیلتر محصولات
                    <svg version="1.1" class="has-solid " viewBox="0 0 36 36" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false" role="img" width="28" height="28" fill="currentColor">
                        <path class="clr-i-outline clr-i-outline-path-1" d="M33,4H3A1,1,0,0,0,2,5V6.67a1.79,1.79,0,0,0,.53,1.27L14,19.58v10.2l2,.76V19a1,1,0,0,0-.29-.71L4,6.59V6H32v.61L20.33,18.29A1,1,0,0,0,20,19l0,13.21L22,33V19.5L33.47,8A1.81,1.81,0,0,0,34,6.7V5A1,1,0,0,0,33,4Z"/><path class="clr-i-solid clr-i-solid-path-1" d="M22,33V19.5L33.47,8A1.81,1.81,0,0,0,34,6.7V5a1,1,0,0,0-1-1H3A1,1,0,0,0,2,5V6.67a1.79,1.79,0,0,0,.53,1.27L14,19.58v10.2Z" style="display:none"/><path d="M33.48,4h-31A.52.52,0,0,0,2,4.52V6.24a1.33,1.33,0,0,0,.39.95l12,12v10l7.25,3.61V19.17l12-12A1.35,1.35,0,0,0,34,6.26V4.52A.52.52,0,0,0,33.48,4Z" class="clr-i-solid clr-i-solid-path-1" style="display:none"/>
                    </svg>
                </h3>
                <form method="get" class="filter-form" id="filter-menu">
                
                  <!-- 🔍 Search -->
                      <input type="hidden" name="query" value="{{ request.GET.query }}">
                      <div class="filter-group">
                          <label>برند:</label>
                          <select name="brand">
                              <option value="">همه</option>
                              {% for brand in product_model.BRANDS %}
                              <option value="{{ brand }}" {% if brand_se == brand %}selected{% endif %}>{{ brand }}</option>
                              {% empty %}
                              {% endfor %}
                          </select>
                      </div>
                
                    <!-- ✅ Category -->
                    <div class="filter-group">
                        <label>دسته‌بندی:</label>
                        <select name="category">
                            <option value="">همه</option>
                            {% for category in product_model.CATEGORY_CHOICES %}
                            <option value="{{ category.0 }}" {% if category_se == category.0 %}selected{% endif %}>{{ category.1 }}</option>
                            {% empty %}
                            {% endfor %}
                        </select>
                    </div>
                
                    <!-- ✅ Skin Type -->
                    <div class="filter-group">
                        <label>نوع پوست:</label>
                        <select name="skin_type">
                            <option value="">همه</option>
                            {% for skin_type in product_model.SKIN_TYPE_CHOICES %}
                            <option value="{{ skin_type.0 }}" {% if skin_type_se == skin_type.0 %}selected{% endif %}>{{ skin_type.1 }}</option>
                            {% empty %}
                            {% endfor %}
                        </select>
                    </div>
                
                    <!-- ✅ Concern -->
                    <div class="filter-group">
                        <label>مشکل پوستی:</label>
                        <input type="text" name="concern" value="{{ request.GET.concern }}" placeholder="مثلا جوش">
                    </div>
                
                    <!-- ✅ Price -->
                    <div class="filter-group price-group">
                        <label>قیمت:</label>
                        <input type="number" name="min_price" value="{{ request.GET.min_price }}" placeholder="حداقل">
                        <input type="number" name="max_price" value="{{ request.GET.max_price }}" placeholder="حداکثر">
                    </div>
                
                    <!-- ✅ Sorting -->
                    <div class="filter-group">
                        <label>مرتب‌سازی:</label>
                        <select name="sort_by">
                            <option value="">پیش‌فرض</option>
                            <option value="price_low" {% if request.GET.sort_by == 'price_low' %}selected{% endif %}>قیمت کم به زیاد</option>
                            <option value="price_high" {% if request.GET.sort_by == 'price_high' %}selected{% endif %}>قیمت زیاد به کم</option>
                            <option value="rating" {% if request.GET.sort_by == 'rating' %}selected{% endif %}>بالاترین امتیاز</option>
                            <option value="popularity" {% if request.GET.sort_by == 'popularity' %}selected{% endif %}>محبوبیت</option>
                        </select>
                    </div>
                
                    <button type="submit" class="page_button">اعمال فیلتر</button>
                </form>
            </aside>

            <div class="products">
                {% for product in products %}
                    <a href="{% url 'product_detail' product.pk %}" class="product_card">
                            <div class="product_image_div">
                                <img src="{{ product.image.url }}" alt="عمس محصول" class="product_image">
                            </div>
                            <div class="product_info">
                                <p class="product_name">{{ product.name }}</p>
                                <p class="product_brand">برند {{ product.brand }}</p>
                                <p class="product_price">{{ product.price|intcomma|persian_numbers }} تومان</p>
                                <div class="product_view-and-rate">
                                    <p class="view">{{ product.views|intcomma|persian_numbers }} بازدید</p>
                                    <p class="rate">{{ product.rating|fa_star_rating|safe }}</p>
                                </div>
                            </div>
                    </a>
                {% empty %}
                    <p>محصولی برای نمایش وجود ندارد.</p>
                {% endfor %}
            </div>
        </section>
    </div>
    <script src="{% static 'mainpage/both.js' %}" charset="utf-8"></script>
</body>
</html>