{% load humanize %}
{% load static %}
{% load persian_filters %}

<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>آنالیز سیستم توصیه</title>
    <link rel="stylesheet" href="{% static 'mainpage/style.css' %}?v=2">
    <link rel="stylesheet" href="{% static 'fontawesome/css/all.min.css' %}">
</head>
<body>
    <main>
        <div class="container" style="margin-top: 100px; padding: 20px;">
            <div style="background: white; border-radius: 10px; padding: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                <h2 style="text-align: right; margin-bottom: 30px;">آنالیز سیستم توصیه</h2>
                <p>صفحه آنالیز در حال توسعه است.</p>
                <a href="{% url 'recommendations:user_recommendations' %}" style="background: #007bff; color: white; padding: 12px 24px; text-decoration: none; border-radius: 5px;">بازگشت</a>
            </div>
        </div>
    </main>
</body>
</html>
{% load static %}

{% block title %}آمار سیستم پیشنهاد{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="text-right mb-4">آمار سیستم پیشنهاد</h2>
    
    <!-- Summary Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title text-primary">{{ total_interactions }}</h5>
                    <p class="card-text">کل تعاملات</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title text-success">{{ total_purchases }}</h5>
                    <p class="card-text">کل خریدها</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title text-info">{{ active_users }}</h5>
                    <p class="card-text">کاربران فعال</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title text-warning">{% widthratio total_purchases total_interactions 100 %}%</h5>
                    <p class="card-text">نرخ تبدیل</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Interaction Types Chart -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="text-right">انواع تعاملات</h5>
                </div>
                <div class="card-body">
                    <canvas id="interactionChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Popular Products -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="text-right">محصولات محبوب</h5>
                </div>
                <div class="card-body">
                    <div class="list-group">
                        {% for product in popular_products %}
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <div class="text-right">
                                    <h6 class="mb-1">{{ product.name }}</h6>
                                    <small class="text-muted">{{ product.brand }}</small>
                                </div>
                                <span class="badge badge-primary badge-pill">{{ product.interaction_count }}</span>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Detailed Statistics -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="text-right">آمار تفصیلی تعاملات</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped text-right">
                            <thead>
                                <tr>
                                    <th>نوع تعامل</th>
                                    <th>تعداد</th>
                                    <th>درصد</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for stat in interaction_stats %}
                                    <tr>
                                        <td>
                                            {% if stat.interaction_type == 'view' %}مشاهده
                                            {% elif stat.interaction_type == 'like' %}پسندیدن
                                            {% elif stat.interaction_type == 'wishlist' %}لیست علاقه‌مندی
                                            {% elif stat.interaction_type == 'cart' %}سبد خرید
                                            {% elif stat.interaction_type == 'purchase' %}خرید
                                            {% else %}{{ stat.interaction_type }}
                                            {% endif %}
                                        </td>
                                        <td>{{ stat.count }}</td>
                                        <td>{% widthratio stat.count total_interactions 100 %}%</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Navigation -->
    <div class="text-center mt-4">
        <a href="{% url 'recommendations:dashboard' %}" class="btn btn-primary">داشبورد پیشنهادات</a>
        <a href="{% url 'recommendations:user_recommendations' %}" class="btn btn-secondary">پیشنهادات شخصی</a>
    </div>
</div>

<!-- Include Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// Create interaction types chart
const ctx = document.getElementById('interactionChart').getContext('2d');
const interactionChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
        labels: [
            {% for stat in interaction_stats %}
                '{% if stat.interaction_type == "view" %}مشاهده{% elif stat.interaction_type == "like" %}پسندیدن{% elif stat.interaction_type == "wishlist" %}لیست علاقه‌مندی{% elif stat.interaction_type == "cart" %}سبد خرید{% elif stat.interaction_type == "purchase" %}خرید{% else %}{{ stat.interaction_type }}{% endif %}',
            {% endfor %}
        ],
        datasets: [{
            data: [
                {% for stat in interaction_stats %}
                    {{ stat.count }},
                {% endfor %}
            ],
            backgroundColor: [
                '#FF6384',
                '#36A2EB',
                '#FFCE56',
                '#4BC0C0',
                '#9966FF',
                '#FF9F40'
            ]
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'bottom',
            }
        }
    }
});
</script>
{% endblock %}
